---
sidebar_label: Services
---

import { Alert } from "@site/src/components/shared/Alert";

# Services

## Static Fields

You can set your API key globally for `BasisTheoryElements` through the static `apiKey` field.

```swift showLineNumbers
BasisTheoryElements.apiKey = "<YOUR PUBLIC BT API KEY>"
```

All [service method](#methods) calls take an optional `apiKey` should you need to override the globally set `apiKey`.

<Alert>
  The <a href="/docs/sdks/mobile/ios/services#proxy">proxy</a> service call does not use this globally set <code>apiKey</code> since its use case is different from the other
  services and requires a <a href="#createsession">session API key</a> for requests.
</Alert>

## Methods

### tokenize

Elements' values can be securely tokenized utilizing our [tokenize](/docs/api/tokens/tokenize) services. To accomplish this, simply pass the Element instance in the payload.

```swift showLineNumbers
let body: [String: Any] = [
  "data": [
    "property": <BasisTheory Element instance>,
    "myProp": "myValue"
  ],
  "search_indexes": ["{{ data.property }}"],
  "type": "token"
]

BasisTheoryElements.tokenize(body: body, apiKey: "<YOUR PUBLIC API KEY>")
  { data, error in ... }
```

<Alert>
  Note that <code>tokenize</code> requires the use of a public API key
  (an API key issued to a <code>public</code> <a href="/docs/concepts/access-controls#what-are-applications">Application</a>).
  Click <a href="https://portal.basistheory.com/applications/create?permissions=token%3Acreate&type=public">here </a>
  to create one in the Basis Theory portal.
</Alert>

The callback provided calls your function with a `data` of type [AnyCodable](https://github.com/Flight-School/AnyCodable#anycodable-1), and an `error` of type [Error](#errors).

### createToken

Elements' values can be securely tokenized utilizing our [createToken](/docs/api/tokens/tokenize#create-token) services. To accomplish this, simply pass the Element instance in the payload.

```swift showLineNumbers
let body: CreateToken = CreateToken(type: "token", data: [
  "property": <BasisTheory Element instance>,
  "myProp": "myValue",
], searchIndexes: ["{{ data.property }}"])

BasisTheoryElements.createToken(body: body, apiKey: "<YOUR PUBLIC API KEY>")
  { data, error in ... }
```

<Alert>
  Note that <code>createToken</code> requires the use of a public API key
  (an API key issued to a <code>public</code> <a href="/docs/concepts/access-controls#what-are-applications">Application</a>).
  Click <a href="https://portal.basistheory.com/applications/create?permissions=token%3Acreate&type=public">here </a>
  to create one in the Basis Theory portal.
</Alert>

The callback provided calls your function with a `data` of type [CreateTokenResponse](https://github.com/Basis-Theory/basistheory-swift/blob/master/docs/CreateTokenResponse.md), and an `error` of type [Error](#errors).

### createSession

To retrieve sensitive data on iOS, you'll need to create a `session` and use its `sessionKey` for making requests securely. To accomplish this, simply construct your `createSession` request like this:

```swift showLineNumbers
BasisTheoryElements.createSession(
    apiKey: "<YOUR PUBLIC BT API KEY>"
) { data, error in ... }
```

The callback provided calls your function with a `data` of type [CreateSessionResponse](https://github.com/Basis-Theory/basistheory-swift/blob/master/docs/CreateSessionResponse.md), and an `error` of type [Error](#errors).

### getTokenById

This function wraps the [get a token API endpoint](/docs/api/tokens/#get-a-token) to retrieve a single strongly typed token.
The token's data is transformed to value references which you can use to [set the value](/docs/sdks/mobile/ios/types#methods) of your elements without touching
the plaintext value and pulling your application into compliance scope.

```swift showLineNumbers
BasisTheoryElements.getTokenById(
    id: "<YOUR TOKEN ID>",
    apiKey: "<YOUR API KEY>",
) { data, error in ... }
```

The callback provided calls your function with a:
* `error` of type [Error](#errors)
* `data` of type `JSON` - `JSON` is a data structure that has dynamic member lookup capabilities. This allows you to traverse a `token` without giving you access to read any sensitive values in `token.data` which means you stay compliant. 

To show a value from the token `data`, traverse the JSON using dot or bracket notation and retrieve the value using the `elementValueReference` property. 
Below is an example of how you do that and set the value reference into a Text Element.

```swift showLineNumbers
@IBOutlet private weak var myTextElement: TextElementUITextField!
...

BasisTheoryElements.getTokenById(
    id: "<YOUR TOKEN ID>",
    apiKey: "<YOUR API KEY>",
) { data, error in 
    myTextElement.setValue(elementValueReference: data!.data!.nested!.property!.elementValueReference)
}
```

### proxy

Proxy provides a simple way to send data securely using an element and/or retrieve data back into an element utilizing our [proxy](/docs/api/proxies) service. To accomplish this, simply construct your `proxy` request like this:

```swift showLineNumbers
@IBOutlet weak var testElement: TextElementUITextField!

let proxyHttpRequest = ProxyHttpRequest(method: .post, body: [
    "testProp": "testValue",
    "testElementPro": testElement,
    "objProp": [
        "nestedTestProp": "nestedTestValue"
    ]
], headers: [
    "X-My-Custom-Header": "headerValue",
])

BasisTheoryElements.proxy(
    apiKey: "<YOUR SESSION BT API KEY>",
    proxyKey: "<YOUR PROXY KEY>",
    proxyHttpRequest: proxyHttpRequest
) { response, data, error in ... }
```

<Alert>
  Note that <code>proxy</code> requires the use of a <code>sessionKey</code> (an API key issued via <a href="#createsession">createSession</a>).
</Alert>

The callback provided calls your function with a:
* `response` of type [URLResponse](https://developer.apple.com/documentation/foundation/urlresponse)
* `error` of type [Error](#errors)
* `data` of type `JSON` - `JSON` is a data structure that has dynamic member lookup capabilities. This allows you to traverse a response from a `proxy` without giving you access to read any sensitive `proxy` response data, which means you stay compliant. To tokenize a JSON property from a `proxy` response, traverse the JSON using dot or bracket notation and retrieve the value using the `elementValueReference` property. As of now, only numbers, booleans, and strings can be retrieved using this method. Below is an example of how you can use a response from a `proxy` with our elements.

```swift showLineNumbers
@IBOutlet private weak var myTextElement: TextElementUITextField!
...

BasisTheoryElements.proxy(
    apiKey: "<YOUR SESSION BT API KEY>",
    proxyKey: "<YOUR PROXY KEY>",
    proxyHttpRequest: proxyHttpRequest)
{ response, data, error in
    myTextElement.setValue(elementValueReference: data.my?.nested?.property?.elementValueReference)

    let body: CreateToken = CreateToken(type: "token", data: [
        "myNestedProxyResponseProperty": myTextElement,
    ])
    BasisTheoryElements.createToken(body: body, apiKey: "<YOUR PUBLIC API KEY>")
    { data, error in print(data) }
}
```

## Errors

| Error | Description |
| --- |--- |
| TokenizingError.applicationTypeNotPublic | The [Application](/docs/api/applications) API key used is not of type `public`. Create a `public` API key through this [link](https://portal.basistheory.com/applications/create?permissions=token%3Acreate&type=public). |
| TokenizingError.invalidInput | An element instance used in a tokenization request is invalid. Check the element events on each element to determine which one is invalid. |
| ProxyError.invalidRequest | The [proxy](#proxy) request is malformed. Revise the [proxy](#proxy) request being attempted. |
| ErrorResponse.error | An instance of [ErrorResponse enum](#errorresponse-enum) gets returned when there's an error from the BasisTheory API. |

### ErrorResponse Enum

| Order | Associated Value Name | Description |
| --- | --- |--- |
| 1 | status | An `Int` describing the response status code |
| 2 | data | A `Data?` instance describing the response body |
| 3 | urlResponse | The raw `UrlResponse?` instance |
| 4 | error | The raw `Error` instance |

<Alert>
  The <code>ErrorResponse</code> enum can be imported from the BasisTheory Swift SDK through the <code>BasisTheory</code> package, which is a dependency of the iOS <code>BasisTheoryElements</code> package.
</Alert>
