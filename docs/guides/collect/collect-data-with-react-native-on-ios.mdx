import { Alert } from "@site/src/components/shared/Alert";
import { AuthButtons } from "@site/src/components/docs/AuthButtons";

# Collect Data with React Native on iOS

This guide will show you how to collect data in a [React Native](https://reactnative.dev/) application on iOS without touching the data.

Key concepts in this guide:

- [Tokens](/docs/concepts/what-are-tokens)
- [Applications](/docs/api/applications)
- [iOS Elements](/docs/sdks/mobile/ios)

## Getting Started

To get started, you will need a Basis Theory account.

<AuthButtons />

Next you will need a [Public Application](/docs/api/applications#application-types) in order to use [iOS Elements](/docs/sdks/mobile/ios) for your app.

[Click here](https://portal.basistheory.com/applications/create?permissions=token%3Acreate&type=public&name=Collect%20Data%20from%20iOS%20Guide) to create a Public Application or
[login to your Basis Theory account](https://portal.basistheory.com/applications) and create a new application with the following settings:

- Name - Collect Data from iOS Guide
- Application Type - Public
- Permissions - `token:create`

<Alert>
  Save the API Key from the created Public Application as it will be used later
  in this guide to initialize the form.
</Alert>

## Setup the Project

We will create a new React Native application by following the instructions outlined on React Native's environment setup [page](https://reactnative.dev/docs/environment-setup). Ensure you have
the following tabs selected:

1. Select the "React Native CLI Quickstart" tab near the start of the page
2. "macOS" selected as the Development OS
3. "iOS" selected as the Target OS

Follow each step on this page down to [Start your application](https://reactnative.dev/docs/environment-setup#step-2-start-your-application) to ensure your environment is set up correctly.

## Install the iOS Elements SDK

We will need to install Basis Theory's [iOS Elements SDK](/docs/sdks/mobile/ios), which will render a secure `UITextField` for capturing the data.

Open your new React Native project in Xcode by opening the file suffixed with `.xcworkspace` in your project under the `ios` directory.

With the Xcode window in focus, select File > Add Packages. In the dialog that appears, enter `https://github.com/Basis-Theory/basistheory-ios` in the search field on the top right, then select "AwesomeProject" on Add to Project (do not select "Pods"),
and click Add Package on this screen and the next prompts.

## Setup Native Module and Bridging Header

Now we need to add a [TextElementUITextField](/docs/sdks/mobile/ios/types#textelementuitextfield) iOS component to our app. To do this we'll add an [iOS Native Module](https://reactnative.dev/docs/native-modules-ios) and set up our TextElement
in Swift, and import it with React Native. We'll start by adding custom native module files.

Add a new Objective-C file called `SsnTextElement.m` under the "AwesomeProject" project in the "AwesomeProject" directory. We will add a method to export the `SsnTextElement` we'll create later, and also add the `tokenize` method required to tokenize
with our [TextElementUITextField](/docs/sdks/mobile/ios/types#textelementuitextfield). This will allow us to expose the `SsnTextElement` component and `tokenize` method in React Native.

```objc showLineNumbers title="AwesomeProject/SsnTextElement.m"
#import <Foundation/Foundation.h>
// highlight-start
#import "React/RCTBridgeModule.h"
#import "React/RCTViewManager.h"

@interface RCT_EXTERN_MODULE(SsnTextElement, RCTViewManager)

RCT_EXTERN_METHOD(
                  tokenize: (RCTPromiseResolveBlock) resolve
                  rejecter: (RCTPromiseRejectBlock) reject
                  )
@end
// highlight-end
```

Add a new Swift file through Xcode called `SsnTextElement.swift` under the "AwesomeProject" project in the "AwesomeProject" directory. After going through the prompts for adding your new `SsnTextElement.swift` file, opt into creating a bridging header for your project.
We will need this bridging header in a bit.

First, let's import our necessary packages into `SsnTextElement.swift`.

```swift showLineNumbers title="AwesomeProject/SsnTextElement.swift"
import Foundation
// highlight-start
import UIKit
import BasisTheoryElements
// highlight-end
```

At this point, you may get an error telling you that `BasisTheoryElements` isn't compatible with the minimum iOS deployment set up for the project. In that case, click on the "AwesomeProject" project and under the "AwesomeProject" target, select "14.0" for the Minimum Deployment.

Now we need to make `RCTViewManager` available to be used in Swift. To do this, we have to import the `RCTViewManager` header in our bridging header.

```objc showLineNumbers title="AwesomeProject/AwesomeProject-Bridging-Header.h"
// highlight-start
#import "React/RCTViewManager.h"
// highlight-end
```

## Add Your Form Component on iOS

Next we'll setup our component on iOS component to our liking. Let's [initiate](/docs/sdks/mobile/ios#initialization) our element, add a [mask](/docs/sdks/mobile/ios/options#mask), and add
some [styling](/docs/sdks/mobile/ios#initialization#styling-elements) in our `SsnTextElement.swift` file with the following code:

```swift showLineNumbers title="AwesomeProject/SsnTextElement.swift"
import Foundation
import UIKit
import BasisTheoryElements

// highlight-start
@objc(SsnElement) class SsnElement: RCTViewManager {
  let ssnTextElement = TextElementUITextField()

  override func view() -> UIView! {
    let regexDigit = try! NSRegularExpression(pattern: "\\d")
    let ssnMask: [Any] = [
      regexDigit,
      regexDigit,
      regexDigit,
      "-",
      regexDigit,
      regexDigit,
      "-",
      regexDigit,
      regexDigit,
      regexDigit,
      regexDigit,
    ]

    try! ssnTextElement.setConfig(options: TextElementOptions(mask: ssnMask))

    ssnTextElement.layer.cornerRadius = 15.0
    ssnTextElement.layer.borderWidth = 1.0
    ssnTextElement.layer.borderColor = UIColor.blue.cgColor
    ssnTextElement.layer.masksToBounds = true
    ssnTextElement.placeholder = "Enter SSN"
    ssnTextElement.backgroundColor = UIColor( red: 200/255, green: 200/255, blue: 200/255, alpha: 1.0 )

    return ssnTextElement
  }
}
// highlight-end
```

Now let's add our function to tokenize. Notice here how we make use of the `resolve` and `rejector` params. These will get used to communicate the results of the tokenize function back to React Native.

```swift showLineNumbers title="AwesomeProject/SsnTextElement.swift"
import Foundation
import UIKit
import BasisTheoryElements

@objc(SsnTextElement) class SsnTextElement: RCTViewManager {
  let ssnTextElement = TextElementUITextField()

  override func view() -> UIView! {
    let regexDigit = try! NSRegularExpression(pattern: "\\d")
    let ssnMask: [Any] = [
      regexDigit,
      regexDigit,
      regexDigit,
      "-",
      regexDigit,
      regexDigit,
      "-",
      regexDigit,
      regexDigit,
      regexDigit,
      regexDigit,
    ]

    try! ssnTextElement.setConfig(options: TextElementOptions(mask: ssnMask))

    ssnTextElement.layer.cornerRadius = 15.0
    ssnTextElement.layer.borderWidth = 1.0
    ssnTextElement.layer.borderColor = UIColor.blue.cgColor
    ssnTextElement.layer.masksToBounds = true
    ssnTextElement.placeholder = "Enter SSN"
    ssnTextElement.backgroundColor = UIColor( red: 200/255, green: 200/255, blue: 200/255, alpha: 1.0 )

    return ssnTextElement
  }

  // highlight-start
  @objc public func tokenize(
    _ resolve: @escaping RCTPromiseResolveBlock,
    rejecter reject: RCTPromiseRejectBlock
  ) -> Void {
    let body = CreateToken(type: "token", data: [
      "ssn": self.ssnTextElement,
    ])

    BasisTheoryElements.createToken(body: body, apiKey: "test_1234567890") {
      data, error in
      guard error == nil else {
        resolve(error!.localizedDescription)
        return
      }

      let encoder = JSONEncoder()
      let json = try! encoder.encode(data)
      resolve(String(data: json, encoding: .utf8)!)
    }
  }
  // highlight-end
}
```

<Alert>
  Be sure to replace <code>test_1234567890</code> with the Public API Key you
  created in the <a href="#getting-started">Getting Started</a> step.
</Alert>

All that's left is to let React Native know that we need to run our `SsnTextElement` on the main queue.

```swift showLineNumbers title="AwesomeProject/SsnTextElement.swift"
import Foundation
import UIKit
import BasisTheoryElements

@objc(SsnTextElement) class SsnTextElement: RCTViewManager {
  let ssnTextElement = TextElementUITextField()

  override func view() -> UIView! {
    let regexDigit = try! NSRegularExpression(pattern: "\\d")
    let ssnMask: [Any] = [
      regexDigit,
      regexDigit,
      regexDigit,
      "-",
      regexDigit,
      regexDigit,
      "-",
      regexDigit,
      regexDigit,
      regexDigit,
      regexDigit,
    ]

    try! ssnTextElement.setConfig(options: TextElementOptions(mask: ssnMask))

    ssnTextElement.layer.cornerRadius = 15.0
    ssnTextElement.layer.borderWidth = 1.0
    ssnTextElement.layer.borderColor = UIColor.blue.cgColor
    ssnTextElement.layer.masksToBounds = true
    ssnTextElement.placeholder = "Enter SSN"
    ssnTextElement.backgroundColor = UIColor( red: 200/255, green: 200/255, blue: 200/255, alpha: 1.0 )

    return ssnTextElement
  }

  @objc public func tokenize(
    _ resolve: @escaping RCTPromiseResolveBlock,
    rejecter reject: RCTPromiseRejectBlock
  ) -> Void {
    let body = CreateToken(type: "token", data: [
      "ssn": self.ssnTextElement,
    ])

    BasisTheoryElements.createToken(body: body, apiKey: "test_1234567890") {
      data, error in
      guard error == nil else {
        resolve(error!.localizedDescription)
        return
      }

      let encoder = JSONEncoder()
      let json = try! encoder.encode(data)
      resolve(String(data: json, encoding: .utf8)!)
    }
  }

  // highlight-start
  @objc static override func requiresMainQueueSetup() -> Bool { return true }
  // highlight-end
}
```

## Add Your Form Component on React Native

Now it's time to mount `SsnTextElement` in React Native. First, we'll go into the `App.tsx` file and setup the view where we'll display the text field.

```typescript jsx showLineNumbers title="App.tsx"
/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 */

import React from 'react';
import {SafeAreaView, StatusBar, StyleSheet, View} from 'react-native';

function App(): JSX.Element {
  return (
    <SafeAreaView>
      <StatusBar />
      <View style={styles.container} />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: 10,
    height: '100%',
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    justifyContent: 'center',
  }
});

export default App;
```

To add our `ssnTextElement` in React Native we'll make use of the native `requireNativeComponent` function to get the iOS element we created earlier.

```typescript jsx showLineNumbers title="App.tsx"
/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 */

import React from 'react';
// highlight-start
import {
  HostComponent,
  requireNativeComponent,
  SafeAreaView,
  StatusBar,
  StyleSheet,
  View,
} from 'react-native';

interface SsnTextElementProps {
  style: Record<string, unknown>;
}

const SsnTextElement: HostComponent<SsnTextElementProps> =
  requireNativeComponent('SsnTextElement');
// highlight-end


function App(): JSX.Element {
  return (
    <SafeAreaView>
      <StatusBar />
      <View style={styles.container}>
        // highlight-start
        <SsnTextElement style={styles.ssnTextElement} />
        // highlight-end
      </View>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: 10,
    height: '100%',
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    justifyContent: 'center',
  },
  // highlight-start
  ssnTextElement: {
    minHeight: 50,
    minWidth: 300,
    marginBottom: 25,
  },
  // highlight-end
});

export default App;
```

Lastly, we'll add a button to trigger our `tokenize` method and a text view to view our tokenize response.

```typescript jsx showLineNumbers title="App.tsx"
/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 */

import React, {useState} from 'react';
// highlight-start
import {
  HostComponent,
  NativeModules,
  Pressable,
  requireNativeComponent,
  SafeAreaView,
  StatusBar,
  StyleSheet,
  Text,
  View,
} from 'react-native';
// highlight-end

interface SsnTextElementProps {
  style: Record<string, unknown>;
}

const SsnTextElement: HostComponent<SsnTextElementProps> =
  requireNativeComponent('SsnTextElement');

// highlight-start
const {SsnTextElement: SsnTextElementModule} = NativeModules;

const tokenize = () => SsnTextElementModule.tokenize() as Promise<string>;
// highlight-end

function App(): JSX.Element {
  // highlight-start
  const [text, setText] = useState<string>();
  // highlight-end

  return (
    <SafeAreaView>
      <StatusBar />
      <View style={styles.container}>
        <SsnTextElement style={styles.ssnTextElement} />
        // highlight-start
        <Pressable
          style={styles.tokenize}
          onPress={async () => {
            setText(await tokenize());
          }}>
          <Text style={styles.tokenizeText}>{'Tokenize'}</Text>
        </Pressable>
        <Text style={styles.tokenText}>{text}</Text>
        // highlight-end
      </View>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: 10,
    height: '100%',
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    justifyContent: 'center',
  },
  ssnTextElement: {
    minHeight: 50,
    minWidth: 300,
    marginBottom: 25,
  },
  // highlight-start
  tokenize: {
    display: 'flex',
    width: 150,
    height: 50,
    border: 'none',
    backgroundColor: '#3483d9',
    textAlign: 'center',
    alignItems: 'center',
    justifyContent: 'center',
    borderRadius: 8,
  },
  tokenizeText: {
    fontSize: 23,
    color: 'white',
    alignItems: 'center',
    justifyContent: 'center',
    paddingHorizontal: 30,
    paddingVertical: 10,
  },
  tokenText: {
    marginTop: 25,
  },
  // highlight-end
});

export default App;
```

## Conclusion

You can now capture any data without your iOS app accessing the underlying value drastically reducing compliance and regulatory scope.

Try running the app with `npx react-native run-ios` and typing in a social security number in the `ssnTextElement` and tap on Tokenize. Basis Theory's iOS SDK will pass the value for the element reference. This will
be securely submitted directly to the [Create Token Endpoint](/docs/api/tokens#create-token). The resulting [token](/docs/concepts/what-are-tokens) is printed to the Xcode console.

## Learn More

- [Send Data to a 3rd Party](/docs/guides/share/send-data-to-third-party)
- [What are tokens?](/docs/concepts/what-are-tokens)
- [Access Controls](/docs/concepts/access-controls)
