---
toc_max_heading_level: 2
---

import {Alert, Alerts} from "@site/src/components/shared/Alert";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import {SdkList} from "@site/src/components/docs/SdkList";
import GettingStartedSection from "@site/src/components/docs/_getting-started-section.mdx";
import {ApplicationSection} from "@site/src/components/docs/ApplicationSection";


# Accept Google Pay

This guide will walk you through the process of accepting Google Pay in your website, while leveraging the Basis Theory platform to perform all necessary operations in PCI-sensitive data. First let's take a look at how the Google Pay payment flow works.

Firstly, you will render the Google Pay button on your page using Google's SDK's. When the user clicks the button, Google Pay will present the payment sheet to the user, which will contain the payment information (e.g., shipping details, transaction amount, card number, expiration date, etc.).

When the user clicks the Google "Pay" button, a sequence of interactions is initiated in three high-level steps:

1. Create Google Pay payment data - The client application (Android or Web) creates a payment data request object that contains the payment information and sends that request to the Google Pay API. The Google Pay API returns a payment data response object, which contains the encrypted payment information.
2. Decrypt Google Pay payment data - The encrypted payment data is sent to Basis Theory for decryption and storage of the sensitive cardholder data. Basis Theory will then return a token that can be used to process the payment.
3. Process Payment - The Basis Theory tokens are forwarded to the payment processor via Basis Theory Proxy, which translate them back to raw data before sending the request. When the successful payment response returns, the client application can complete the payment and inform the user that the payment was successful.

{/* TODO: Add a diagram here? */}

## Getting Started

### Basis Theory Setup

<GettingStartedSection/>

### Google Pay Setup

To start, we want to ensure that you're able to connect to Google's APIs. Make sure you've met all the pre-requisites in Google's [setup guide](https://developers.google.com/pay/api/web/guides/setup).

## Rendering the Google Pay Button

The integration between your client application and Google can be done directly, without any involvement from Basis Theory.

{/*
massage section
*/}

ðŸ‘‰ Please follow Google's official guides for [Web](https://developers.google.com/pay/api/web/guides/tutorial) all the way until step 9. When on step 2, set `gateway` to `basistheory` and `gatewayMerchantId` to your tenantId created from the [Basis Theory Setup](#basis-theory-setup).

{/*
add note about merchant id and what it should be
*/}

## Storing the Google Pay Payment Data with Basis Theory

{/*
1. Create a public key
 1. Needs `token-intent:create`
2. POST /connections/google-pay/tokenize
3. Show the token-intent and what you get back
*/}

### Create a Public Key

<ApplicationSection type="public" permissions={["token-intent:create"]}/>

### Tokenize the Payment Data

Once you have the encrypted payment data, you'll use your newly created public key from your frontend application to send the payment data using the [Google Pay](/docs/api/orchestration/google-pay) endpoint.

<Tabs className="bt-tabs" groupId="languages">
  <TabItem value="shell" label="cURL">

    ```shell showLineNumbers
    curl --request POST \
    --url https://api.basistheory.com/connections/google-pay/tokenize \
    --header 'BT-API-KEY: <PUBLIC_API_KEY>' \
    --header 'Content-Type: application/json' \
    --data '{
    "google_payment_method_token": {
    "protocolVersion": "ECv2",
    "signature": "...",
    "intermediateSigningKey": {
    "signedKey": "...",
    "signatures": [
    "..."
    ]
  },
    "signedMessage": "..."
  }'
    ```
  </TabItem>

          <TabItem value="node" label="Node">
```javascript
    await client.googlepay.tokenize({
    googlePaymentMethodToken: {...}
  });
    ```
    </TabItem>
    <TabItem value="csharp" label="C#">
  ```csharp showLineNumbers
    await client.Googlepay.TokenizeAsync(new GooglePayTokenizeRequest
  {
    GooglePaymentMethodToken = new GooglePaymentMethodToken
  {
    ...
  }
  });
    ```
    </TabItem>
    <TabItem value="python" label="Python">
  ```python showLineNumbers
    client.googlepay.tokenize(
    google_payment_method_token={
    ...
  }
    )
    ```
    </TabItem>
</Tabs>

  The result of this call will be a [token intent](/docs/api/tokens/token-intents#token-intent-object) that you can use to process the payment. The type of token intent will either be `card` or `network_token` depending on the `AuthMethod` of the card that was available for the GPay token.

  {/*
  TODO: point out the differences between a card and network token and FPANs vs DPANs
  */}

  ## Processing the GPay token

  ### Create a Private Key

  <ApplicationSection type="private" permissions={["token-intent:use"]}/>

  ### Charge a Card

  Payment service providers (PSPs) may differ in how they handle this operation, offering workflows like "authorization and capture" or "direct charge."

    <Tabs className="bt-tabs" queryString="processor">
      <TabItem value="adyen" label="Adyen">

    In Adyen, you can charge a card by creating a [payment](https://docs.adyen.com/api-explorer/Checkout/latest/post/payments).

  {/*
  TODO: find out what key to use for this Adyen call
  */}
```shell showLineNumbers title="Create a transaction"
curl 'https://api.basistheory.com/proxy' \
-X 'POST' \
// highlight-start
-H 'BT-API-KEY: <PRIVATE_API_KEY>' \
-H 'BT-PROXY-URL: https://checkout-test.adyen.com/v71/payments' \
-H 'Authorization: Bearer <REPLACE_ME>' \
// highlight-end
-H 'Content-Type: application/json' \
-d '{
  "amount": {
    "currency": "USD",
    "value": 1000
  },
// highlight-start
  "paymentMethod": {
    "type": "scheme",
    "number": "{{ token_intent: d2cbc1b4-5c3a-45a3-9ee2-392a1c475ab4 | json: \"$.data.number\" }}",
    "expiryMonth": "{{ token_intent: d2cbc1b4-5c3a-45a3-9ee2-392a1c475ab4 | json: \"$.data\" | card_exp: \"MM\" }}",
    "expiryYear": "{{ token_intent: d2cbc1b4-5c3a-45a3-9ee2-392a1c475ab4 | json: \"$.data\" | card_exp: \"YYYY\" }}",
    "brand": "googlepay"
  },
// highlight-end
  "mpiData": {
    "directoryResponse": "Y",
    "authenticationResponse": "Y",
// highlight-start
    "cavv": "{{ token_intent: d2cbc1b4-5c3a-45a3-9ee2-392a1c475ab4 | json: \"$.data.authentication.threeds_cryptogram\" }}",
    "eci": "{{ token_intent: d2cbc1b4-5c3a-45a3-9ee2-392a1c475ab4 | json: \"$.data.authentication.eciIndicator\" }}"
// highlight-end
  },
  "additionalData": {
    "paymentdatasource.type": "googlepay",
    "paymentdatasource.tokenized": "true"
  },
  "shopperInteraction": "Ecommerce"
}'
```
  </TabItem>
</Tabs>

<Alert>You are not restricted to only using Adyen. You can use any payment processor that accepts Google Pay tokens.</Alert>

  ## Preparing for Production

  Once you're ready for production, you'll want to publish your integration with Google Pay by following the [official guide](https://developers.google.com/pay/api/web/guides/test-and-deploy/publish-your-integration). Once you have your official `merchantId`, you can update your `merchantId` in the payment data request to Google Pay, and change the `environment` to `PRODUCTION`.
